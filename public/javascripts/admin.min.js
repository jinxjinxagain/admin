var qtPayApp=angular.module("qtPayApp",["ng-admin"]);qtPayApp.config(["RestangularProvider",function(e){e.addFullRequestInterceptor(function(e,l,i,a,t,d){if("getList"==l&&d._filters){for(var n in d._filters)d[n]=d._filters[n];delete d._filters}return{params:d}})}]),qtPayApp.config(["NgAdminConfigurationProvider",function(e){function l(e){return'<span class="glyphicon glyphicon-'+e+'"></span>'}var i=e.application("蜻蜓FM支付管理系统").baseApiUrl("/"),a=e.field("id").label("ID"),t=e.entity("p_entities").identifier(a).label("付费收听项目"),d=e.entity("p_items").identifier(a).label("付费套餐"),n=[e.field("name").label("项目名称").isDetailLink(!0),e.field("type","choice").label("类型").choices([{value:"channel_ondemand_temp_only",label:"直播付费的点播专辑"},{value:"channel_ondemand",label:"整个点播专辑"},{value:"channel_ondemand_partial",label:"部分点播专辑"},{value:"channel_live",label:"直播流"},{value:"program",label:"单个节目"},{value:"category",label:"全频道"},{value:"app_vip",label:"APP VIP会员"},{value:"wx_campaign",label:"微信活动"}]),e.field("entity_id").label("所属内容ID"),e.field("disabled","boolean").defaultValue(!1).label("禁用")],s=n.concat([a.editable(!1)]);t.listView().title("付费收听项目 列表").fields(s).filters([e.field("entity_id").label("内容ID")]).perPage(10),t.creationView().title("新建 付费收听项目").fields(t.listView().fields().concat([e.field("image").label("项目配图URL"),e.field("icon").label("项目图标URL"),e.field("details","wysiwyg").label("套餐说明"),e.field("details_url","string").label("套餐说明链接"),e.field("description").label("付费推荐语"),e.field("parent","reference").targetEntity(t).targetField(e.field("name")).label("父项目")])),t.editionView().title("修改 {{ entry.values.name }}").fields(t.creationView().fields().concat([e.field("purchase_items","referenced_list").targetEntity(d).targetReferenceField("purchase_entity_id").targetFields([e.field("name").label("名称").isDetailLink(!0),e.field("duration").label("收费时长"),e.field("fee","float").label("价格").format("$0.00")]).label("套餐配置"),e.field("purchase_entities","referenced_list").targetEntity(t).targetReferenceField("parent").targetFields([e.field("name").label("名称").isDetailLink(!0),e.field("entity_id").label("内容ID")]).label("子项目")]));var r=e.field("purchase_entity_id","reference").targetEntity(t).targetField(e.field("name")).label("付费项目"),f=[e.field("name").label("名称").isDetailLink(!0),r,e.field("disabled","boolean").defaultValue(!1).label("禁用"),e.field("duration").label("收费时长"),e.field("original_fee","float").label("原价").format("$0.00"),e.field("fee","float").label("价格").format("$0.00"),a.editable(!1).isDetailLink(!1)];d.listView().title("付费套餐 列表").fields(f).filters([r]).perPage(10),d.creationView().title("新建 付费套餐").fields(f),d.editionView().title("修改 {{ entry.values.name }}").fields(f),i.addEntity(t),i.addEntity(d);var b=e.entity("orders").label("历史账单"),o=e.field("type").label("类型").template('<img ng-src="/images/{{value}}.png" style="width:1.2em" />'),c=e.field("state","choice").choices([{label:"有效",value:"active"},{label:"过期",value:"expired"},{label:"下单",value:"ordered"},{label:"未知",value:"unknown"},{label:"准有效",value:"semi-active"},{label:"接近过期",value:"expiring"}]).label("状态").editable(!1),m=e.field("order_time").label("下单时间").isDetailLink(!0),u=e.field("fee","float").label("交易额").format("$0.00").editable(!1),p=e.field("id").label("内部交易号").editable(!1),_=[c,e.field("entity_id").label("主内容ID").editable(!1),e.field("purchase_item_id","reference").targetEntity(d).targetField(e.field("name")).label("套餐").editable(!1)];b.listView().title("历史账单 列表").fields([p,m,u,o,e.field("user.username").label("用户名")].concat(_)).filters([e.field("user_id").label("用户ID"),e.field("start_time","date").label("在此之后的订单"),e.field("end_time","date").label("在此之前的订单")].concat(_)).perPage(20).sortField("order_time"),b.editionView().title("{{ entry.values.id }} 详情").fields([e.field("trade_id").label("外部交易号").editable(!1),c,u,o,e.field("order_time").label("下单时间"),e.field("paid_time").label("付款时间"),e.field("expire_time").label("过期时间"),e.field("user_id").label("用户ID").editable(!1),e.field("user.username").label("用户名"),e.field("purchase_item_id","reference").targetEntity(d).targetField(e.field("id")).label("套餐").editable(!1),e.field("entity_id").label("主内容"),e.field("entity_ids").label("所有内容ID"),e.field("caster_ids").label("主播ID"),e.field("prepay_data","json").label("预付数据（客户端发请求用）"),e.field("response_data","json").label("异步回调数据"),e.field("confirm_data","json").label("同步回调数据（客户端提交）")]),i.addEntity(b);var y=e.entity("awards").label("打赏历史").identifier(e.field("id"));y.listView().fields([e.field("id").label("ID").isDetailLink(!0).editable(!1),o,e.field("user.username").label("用户"),e.field("caster.nick_name").label("主播"),e.field("fee","float").label("金额").format("$0.00"),e.field("paid_time","datetime").label("打赏时间")]).perPage(20).filters([e.field("user_id").label("用户ID"),e.field("caster_id").label("主播ID"),e.field("start_time","date").label("在此之后的打赏"),e.field("end_time","date").label("在此之前的打赏")]),y.editionView().fields(y.listView().fields().concat([e.field("user_id").label("用户ID").editable(!1),e.field("caster_id").label("主播ID").editable(!1),e.field("order_time","datetime").label("下单时间"),e.field("expire_time","datetime").label("过期时间"),e.field("trade_id").label("外部交易号").editable(!1),e.field("prepay_data","json").label("预付数据（客户端发请求用）"),e.field("response_data","json").label("异步回调数据"),e.field("confirm_data","json").label("同步回调数据（客户端提交）")])),i.addEntity(y);var w=e.entity("awardstats").label("打赏统计");w.listView().fields([e.field("caster.nick_name").label("主播").isDetailLink(!0),e.field("caster_id").label("主播ID").isDetailLink(!0),e.field("total_fee","float").label("总打赏金额").format("$0.00"),e.field("total_awards","number").label("总打赏次数"),e.field("today_stats.today_fee","float").label("今日打赏金额").format("$0.00"),e.field("today_stats.today_awards","number").label("今日打赏次数")]).filters([e.field("caster_id").label("主播ID")]),w.editionView().fields(w.listView().fields().concat([e.field("id").label("ID").editable(!1),e.field("top_awards_limit","number").label("排行榜人数"),e.field("top_awards","json").label("排行榜").editable(!1),e.field("entry_stats","json").label("入口统计").editable(!1),e.field("daily_awards","json").label("日统计").editable(!1),e.field("lastAudit","json").label("审核结果").editable(!1)])),w.creationView().fields(w.editionView().fields()),i.addEntity(w);var h=e.entity("userstats").baseApiUrl("/awardstats/").identifier(e.field("id")).label("用户打赏统计");h.listView().fields([e.field("user.username").label("用户").editable(!1),e.field("user_id").label("用户ID").isDetailLink(!0).editable(!1),e.field("total_fee","number").label("总打赏金额").editable(!1),e.field("total_awards","number").label("总打赏次数").editable(!1)]),h.editionView().fields(h.listView().fields()),i.addEntity(h);var v=e.entity("items").baseApiUrl("/redpacks/").label("红包项目");v.listView().fields([e.field("act_name").label("活动名称").isDetailLink(!0),e.field("send_name").label("发送者"),e.field("total_amount","float").label("金额")]),v.creationView().fields(v.listView().fields().concat([e.field("wishing").label("祝福语"),e.field("remark").label("备注")])),v.editionView().fields(v.creationView().fields().concat([e.field("id").label("ID").editable(!1)])),i.addEntity(v);var g=e.entity("redpacks").label("红包");g.listView().fields([e.field("openid").label("微信用户ID").isDetailLink(!0),e.field("send_time","datetime").label("发放时间"),e.field("comment").label("备注"),e.field("item_id","reference").targetEntity(v).targetField(e.field("act_name")).label("项目")]).filters([e.field("openid").label("微信用户ID").isDetailLink(!0),e.field("comment").label("备注")]),g.editionView().fields(g.listView().fields().concat([e.field("send_listid").label("微信账单号"),e.field("mch_billno").label("账单号"),e.field("prepay_data","json").label("预付数据"),e.field("response_data","json").label("回复数据")])),i.addEntity(g);var V=e.entity("rpusers").baseApiUrl("/redpacks/").label("红包屏蔽用户");V.listView().fields([e.field("openid").label("微信用户ID").isDetailLink(!0),e.field("setTime","datetime").label("记录时间"),e.field("comment").label("备注")]),V.editionView().fields(g.listView().fields()),V.creationView().fields(g.listView().fields()),V.showView().fields(g.listView().fields()),i.addEntity(V);var D=e.entity("rpusermsgs").baseApiUrl("/redpacks/").label("红包特殊回复");D.listView().fields([e.field("openid").label("微信用户ID").isDetailLink(!0),e.field("setTime","datetime").label("记录时间"),e.field("comment").label("备注")]),D.showView().fields(g.listView().fields()),i.addEntity(D);var k=e.entity("transits").baseApiUrl("/accounts/").identifier(e.field("_id")).label("流水管理"),I=[e.field("caster_id").label("主播ID").isDetailLink(!0).editable(!1),e.field("time","datetime").label("时间").editable(!1),e.field("fee","float").format("0.00").label("交易额"),e.field("source").label("来源").editable(!1),e.field("complete","boolean").label("处理")];k.listView().fields(I).filters([e.field("caster_id").label("主播ID"),e.field("start_time","date").label("在此之后的流水"),e.field("end_time","date").label("在此之前的流水")]),k.showView().fields(I),i.addEntity(k);var C=e.entity("accounts").label("主播账户").identifier(e.field("caster_id")),E=[e.field("caster.nick_name").label("主播名").isDetailLink(!0),e.field("balance","float").label("余额").format("$0.00"),e.field("total","float").label("累计总额").format("$0.00")];C.listView().fields(E.concat([e.field("caster_id").label("主播ID"),e.field("lastUpdate.order","datetime").label("付费内容结算时间"),e.field("lastUpdate.award","datetime").label("打赏结算时间")])).filters([e.field("caster_id").label("主播ID")]),C.editionView().fields(C.listView().fields().concat([e.field("awardRoyalty.enabled","boolean").label("打赏分成开关"),e.field("awardRoyalty.ratio","float").label("打赏分成比例"),e.field("orderRoyalty.enabled","boolean").label("付费内容分成开关"),e.field("orderRoyalty.ratio","float").label("付费内容分成比例"),e.field("transits","referenced_list").label("近期流水").targetEntity(k).targetReferenceField("caster_id").targetFields([e.field("time","datetime").label("时间"),e.field("source").label("来源"),e.field("fee","float").label("金额").format("0.00"),e.field("complete","boolean").label("处理")]).sortField("time").sortDir("DESC")])),i.addEntity(C);var $=e.entity("tickets").label("蜻蜓券").identifier(e.field("use_code"));$.listView().fields([e.field("types","choice").choices([{value:"voucher",label:"代金券"},{value:"item",label:"节目券"}]).label("类型"),e.field("use_code").label("兑换码").isDetailLink(!0),e.field("state","choice").choices([{value:"disable",label:"被禁用"},{value:"active",label:"未被使用"},{value:"pending",label:"提交中"},{value:"used",label:"已使用"},{value:"expire",label:"过期"}]).label("状态"),e.field("expire_time").label("过期时间"),e.field("name").label("备注")]).title("蜻蜓券 列表"),$.creationView().fields([e.field("type","choice").choices([{value:"voucher",label:"代金券"},{value:"item",label:"节目券"}]).label("类型"),e.field("number","number").label("数量"),e.field("info","number").label("金额"),e.field("info","reference").targetEntity(d).targetField(e.field("name")).label("套餐ID")]).title("生成 蜻蜓券"),$.editionView().title("{{entry.values.use_code}}").fields([e.field("use_code").label("兑换码").editable(!1),e.field("disable","boolean").label("禁用").validation({required:!0}),e.field("expire_time").label("过期时间").validation({required:!0}),e.field("used_time").label("使用时间").editable(!1),e.field("used_by").label("订单号").editable(!1)]),i.addEntity($);var L=e.entity("p_users").label("内测用户");L.listView().fields([e.field("user_id").label("用户系统ID").isDetailLink(!0),e.field("comment").label("备注"),e.field("scope").label("范围")]).title("内测用户 列表"),L.creationView().title("新建 内测用户").fields(L.listView().fields()),L.editionView().title("修改 {{ entry.values.name }}").fields(L.listView().fields()),i.addEntity(L);var q=e.entity("users").baseApiUrl("/admin/").label("网站用户");q.listView().fields([e.field("username").label("ID").isDetailLink(!0),e.field("name").label("姓名"),e.field("role").label("角色")]),q.editionView().fields(q.listView().fields()),i.addEntity(q),i.dashboard(e.dashboard().addCollection(e.collection(b).name("orders").title("历史账单").perPage(10).fields([m,o,c,u])).addCollection(e.collection(y).name("awards").title("打赏历史").perPage(10).fields([e.field("user.username").label("用户"),e.field("caster.nick_name").label("主播"),e.field("fee","float").label("金额").format("$0.00"),e.field("paid_time","datetime").label("打赏时间")])).addCollection(e.collection(w).name("awardStats").title("打赏统计").perPage(10).fields(w.listView().fields())).addCollection(e.collection(C).name("accounts").title("主播账户").perPage(10).fields(E)));var F='<div class="navbar-header"><a class="navbar-brand" href="#" ng-click="appController.displayHome()">蜻蜓FM支付管理系统</a></div><p class="navbar-text navbar-right">'+($qtpay?"<span>"+$qtpay.user.name+'</span> <a href="/admin/chpwd">修改密码</a> <a href="/admin/logout">注销</a>':'<a href="/admin/login">登录</a>')+"</p>";i.header(F);var P=e.menu(),x=$qtpay&&$qtpay.user&&$qtpay.user.role&&(-1!=$qtpay.user.role.indexOf("admin")||-1!=$qtpay.user.role.indexOf("super"));$qtpay&&$qtpay.user&&$qtpay.user.role&&((x||-1!=$qtpay.user.role.indexOf("order"))&&P.addChild(e.menu().title("付费收听").icon(l("headphones")).addChild(e.menu(t).icon(l("cd"))).addChild(e.menu(d).icon(l("th-list"))).addChild(e.menu(b).icon(l("yen")))),(x||-1!=$qtpay.user.role.indexOf("award"))&&P.addChild(e.menu().title("打赏").icon(l("thumbs-up")).addChild(e.menu(y).icon(l("thumbs-up"))).addChild(e.menu(w).icon(l("sort"))).addChild(e.menu(h).icon(l("user")))),(x||-1!=$qtpay.user.role.indexOf("redpack"))&&P.addChild(e.menu().title("红包").icon(l("yen")).addChild(e.menu(v).icon(l("check"))).addChild(e.menu(g).icon(l("yen"))).addChild(e.menu(V).icon(l("user"))).addChild(e.menu(D).icon(l("comment")))),x&&P.addChild(e.menu().title("主播管理").icon(l("user")).addChild(e.menu(C).icon(l("user"))).addChild(e.menu(k).icon(l("usd")))).addChild(e.menu($).icon(l("barcode"))),-1!=$qtpay.user.role.indexOf("super")&&P.addChild(e.menu().title("管理").icon(l("cog")).addChild(e.menu(L).icon(l("user"))).addChild(e.menu(q).icon(l("user"))))),i.menu(P),e.configure(i)}]);